board := "ncl/boards/ch32x-48.ncl"

default: build

_libsmartkeymap:
  make libsmartkeymap

cmake-generate: _libsmartkeymap
  mkdir -p build
  cd build && \
    cmake \
      --toolchain=../../toolchains/riscv-none-elf.cmake \
      -D BOARD={{board}} \
      ..

build: cmake-generate
  cd build && \
    make

await-bootloader:
  timeout 30 ./scripts/wchisp-await-bootloader.sh

flash: build await-bootloader
  wchisp flash build/usb-device-compositekm.hex
